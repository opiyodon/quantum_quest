modify these codes, `templates/index.html`=`<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Quest</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
</head>

<body>
    <div id="chat-container">
        <div id="chat-sidebar">
            <h3>Chat History</h3>
            <ul id="chat-history-list"></ul>
            <button id="clear-history">Clear All Chats</button>
        </div>
        <div id="main-content">
            <header>
                <div class="logo-title">
                    <div class="logo">
                        <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 6H42L36 24L42 42H6L12 24L6 6Z" fill="currentColor"></path>
                        </svg>
                    </div>
                    <h1>Quantum Quest</h1>
                </div>
                <div class="profile-dropdown">
                    <img src="{{ user.profile_picture if user.profile_picture else url_for('static', filename='default_profile.png') }}"
                         alt="Profile" id="profile-img">
                    <div class="dropdown-content">
                        <a href="#" id="profile-btn">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </a>
                        <a href="{{ url_for('logout') }}" class="logout-btn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </a>
                    </div>
                </div>
            </header>
            <div id="chat-content">
                <h2>Welcome to Quantum Quest!</h2>
                <p>I'm your guide to the cosmos. Ask me anything!</p>
                <div id="chat-messages"></div>
            </div>
            <div id="input-container">
                <textarea id="user-input" class="custom-scrollbar form-input" placeholder="Ask me anything"></textarea>
                <button id="mic-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        viewBox="0 0 256 256">
                        <path
                            d="M128,176a48.05,48.05,0,0,0,48-48V64a48,48,0,0,0-96,0v64A48.05,48.05,0,0,0,128,176ZM96,64a32,32,0,0,1,64,0v64a32,32,0,0,1-64,0Zm40,143.6V232a8,8,0,0,1-16,0V207.6A80.11,80.11,0,0,1,48,128a8,8,0,0,1,16,0,64,64,0,0,0,128,0,8,8,0,0,1,16,0A80.11,80.11,0,0,1,136,207.6Z">
                        </path>
                    </svg>
                </button>
                <button id="send-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M224.4 32.3c-3.6-3.6-8.9-4.7-13.6-2.9L30.8 118.4c-5.1 2-8.4 6.6-8.7 11.8s2.4 10.1 7.2 12.8l56.3 31.5 31.5 56.3c2.7 4.8 7.7 7.7 13.1 7.5 5.4-.2 10.1-3.4 12.1-8.4l89-180c1.8-4.7.7-10-2.9-13.6zM52.8 126.6L193.5 62 115.1 140.4 52.8 126.6zm76.6 76.6l-13.8-62.3 78.4-78.4L130.2 203.2z"/>
                      </svg>
                </button>
            </div>
        </div>
    </div>
    
    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Update Profile</h2>
            <form id="profile-form" action="{{ url_for('update_profile') }}" method="POST" enctype="multipart/form-data">
                <input class="form-input" type="text" name="username" placeholder="New Username" value="{{ user.username }}">
                <input class="form-input" type="password" name="password" placeholder="New Password">
                <input class="form-input" type="file" name="profile_picture" accept="image/*">
                <button type="submit">Update</button>
            </form>
            <div class="danger-zone">
                <h3>Danger Zone</h3>
                <button id="delete-account">Delete Account</button>
            </div>
        </div>
    </div>

    <div id="notification-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="{{ url_for('static', filename='validation.js') }}"></script>
    <script src="{{ url_for('static', filename='page-loader.js') }}"></script>
</body>

</html>`,`static/script.js`=`const socket = io();

document.addEventListener('DOMContentLoaded', function () {
    const chatMessages = document.getElementById('chat-messages');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const micBtn = document.getElementById('mic-btn');
    const chatHistoryList = document.getElementById('chat-history-list');
    const clearHistoryBtn = document.getElementById('clear-history');
    const notificationContainer = document.getElementById('notification-container');
    const profileImg = document.getElementById('profile-img');
    const profileBtn = document.getElementById('profile-btn');
    const profileModal = document.getElementById('profile-modal');
    const closeModal = document.getElementsByClassName('close')[0];
    const profileForm = document.getElementById('profile-form');
    const deleteAccountBtn = document.getElementById('delete-account');

    let isRecording = false;
    let mediaRecorder;

    function sendMessage() {
        const message = userInput.value.trim();
        if (message) {
            addMessageToChat('You', message, 'user-message');
            socket.emit('user_message', { message: message });
            userInput.value = '';
        }
    }

    function addMessageToChat(sender, message, className) {
        const messageElement = document.createElement('div');
        messageElement.className = `message ${className}`;
        messageElement.innerHTML = `
            <div class="sender">${sender}</div>
            <div class="message-content">${marked.parse(message)}</div>
            <div class="timestamp">${new Date().toLocaleTimeString()}</div>
        `;
        chatMessages.appendChild(messageElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', function (event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            sendMessage();
        }
    });

    socket.on('bot_message', function (data) {
        addMessageToChat('Quantum Quest', data.message, 'bot-message');
    });

    micBtn.addEventListener('click', toggleRecording);

    async function toggleRecording() {
        if (!isRecording) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.start();
                isRecording = true;
                micBtn.classList.add('recording');

                const audioChunks = [];
                mediaRecorder.addEventListener("dataavailable", event => {
                    audioChunks.push(event.data);
                });

                mediaRecorder.addEventListener("stop", () => {
                    const audioBlob = new Blob(audioChunks);
                    sendAudioToServer(audioBlob);
                });

            } catch (err) {
                console.error('Error accessing microphone:', err);
            }
        } else {
            mediaRecorder.stop();
            isRecording = false;
            micBtn.classList.remove('recording');
        }
    }

    function sendAudioToServer(audioBlob) {
        const formData = new FormData();
        formData.append("audio", audioBlob);

        fetch('/transcribe', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                if (data.transcription) {
                    userInput.value = data.transcription;
                    sendMessage();
                }
            })
            .catch(error => console.error('Error:', error));
    }

    profileImg.onclick = function(event) {
        event.stopPropagation();
        const dropdownContent = document.querySelector('.dropdown-content');
        dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
    }

    profileBtn.onclick = function() {
        profileModal.style.display = "block";
    }

    closeModal.onclick = function() {
        profileModal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == profileModal) {
            profileModal.style.display = "none";
        }
        if (!event.target.matches('#profile-img')) {
            const dropdowns = document.getElementsByClassName("dropdown-content");
            for (let i = 0; i < dropdowns.length; i++) {
                let openDropdown = dropdowns[i];
                if (openDropdown.style.display === 'block') {
                    openDropdown.style.display = 'none';
                }
            }
        }
    }

    function setupProfileForm() {
        profileForm.addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch('/update_profile', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showNotification('success', data.message);
                        // Update the profile picture if it was changed
                        const fileInput = profileForm.querySelector('input[type="file"]');
                        if (fileInput.files.length > 0) {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                document.getElementById('profile-img').src = e.target.result;
                            };
                            reader.readAsDataURL(fileInput.files[0]);
                        }
                    } else {
                        showNotification('error', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('error', 'An error occurred while updating the profile');
                });
        });
    }

    function setupDeleteAccount() {
        deleteAccountBtn.addEventListener('click', function () {
            showConfirmation('Are you sure you want to delete your account? This action cannot be undone.', function () {
                fetch('/delete_account', {
                    method: 'POST'
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            showNotification('success', data.message);
                            setTimeout(() => {
                                window.location.href = '/login';
                            }, 2000);
                        } else {
                            showNotification('error', data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showNotification('error', 'An error occurred while deleting the account');
                    });
            });
        });
    }

    function loadChatHistory() {
        fetch('/chat_history')
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    chatHistoryList.innerHTML = '';
                    data.history.forEach(chat => {
                        const li = document.createElement('li');
                        li.textContent = chat.user_message.substring(0, 30) + '...';
                        li.onclick = () => loadChat(chat._id);
                        chatHistoryList.appendChild(li);
                    });
                }
            })
            .catch(error => console.error('Error:', error));
    }

    function loadChat(chatId) {
        fetch(`/load_chat/${chatId}`)
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    chatMessages.innerHTML = '';
                    data.chat.forEach(message => {
                        addMessageToChat(message.sender, message.content, message.sender === 'You' ? 'user-message' : 'bot-message');
                    });
                }
            })
            .catch(error => console.error('Error:', error));
    }

    clearHistoryBtn.onclick = function () {
        showConfirmation('Are you sure you want to clear all chat history?', function () {
            fetch('/clear_all_chats')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        chatHistoryList.innerHTML = '';
                        showNotification('success', 'Chat history cleared');
                    } else {
                        showNotification('error', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('error', 'An error occurred');
                });
        });
    }

    function showNotification(type, message) {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        const notificationContent = `
            <div class="notification-header">
                <span>${type === 'success' ? 'Success' : 'Error'}</span>
                <button class="notification-close">&times;</button>
            </div>
            <p>${message}</p>
            <div class="notification-progress">
                <div class="notification-progress-bar"></div>
            </div>
        `;
        notification.innerHTML = notificationContent;
        notificationContainer.appendChild(notification);

        const progressBar = notification.querySelector('.notification-progress-bar');
        const closeButton = notification.querySelector('.notification-close');

        closeButton.addEventListener('click', () => {
            notificationContainer.removeChild(notification);
        });

        const duration = 5000; // 5 seconds
        progressBar.style.transition = `width ${duration}ms linear`;
        setTimeout(() => {
            progressBar.style.width = '100%';
        }, 10);

        setTimeout(() => {
            notificationContainer.removeChild(notification);
        }, duration);
    }

    function showConfirmation(message, onConfirm) {
        const confirmation = document.createElement('div');
        confirmation.className = 'confirmation';
        confirmation.innerHTML = `
            <div class="confirmation-header">
                <span>Confirmation</span>
                <button class="confirmation-close">&times;</button>
            </div>
            <p>${message}</p>
            <div class="confirmation-actions">
                <button class="confirm-yes">Yes</button>
                <button class="confirm-no">No</button>
            </div>
        `;
        notificationContainer.appendChild(confirmation);

        const closeButton = confirmation.querySelector('.confirmation-close');
        const yesButton = confirmation.querySelector('.confirm-yes');
        const noButton = confirmation.querySelector('.confirm-no');

        closeButton.addEventListener('click', () => {
            notificationContainer.removeChild(confirmation);
        });

        noButton.addEventListener('click', () => {
            notificationContainer.removeChild(confirmation);
        });

        yesButton.addEventListener('click', () => {
            notificationContainer.removeChild(confirmation);
            onConfirm();
        });
    }

    // Initialize everything
    setupProfileForm();
    setupDeleteAccount();
    loadChatHistory();
});`,`app.py`=`from flask import Flask, render_template, request, redirect, url_for, session, jsonify
from flask_socketio import SocketIO, emit
from werkzeug.security import generate_password_hash, check_password_hash
from werkzeug.utils import secure_filename
from itsdangerous import URLSafeTimedSerializer, SignatureExpired
from config import Config
from database import db
from models import Question, UserProgress, User
import os
import base64
import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
from bson import ObjectId

app = Flask(__name__)
app.config.from_object(Config)
socketio = SocketIO(app)
s = URLSafeTimedSerializer(app.config['SECRET_KEY'])

def send_email(to_email, subject, body):
    msg = MIMEMultipart('alternative')
    msg['From'] = app.config['MAIL_USERNAME']
    msg['To'] = to_email
    msg['Subject'] = subject

    html_body = f"""
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Reset Your Password</title>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&display=swap');
            body {{
                font-family: 'Space Grotesk', sans-serif;
                background: black;
                color: black;
                margin: 0;
                padding: 20px;
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
            }}
            .email-container {{
                background: grey;
                border-radius: 15px;
                backdrop-filter: blur(10px);
                box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.3);
                max-width: 600px;
                padding: 20px;
                text-align: center;
            }}
            .logo-title {{
                display: flex;
                align-items: center;
                gap: 5px;
                justify-content: center;
                margin-bottom: 20px;
            }}
            .logo {{
                width: 24px;
                height: 24px;
                color: black;
            }}
            h1 {{
                font-size: 24px;
                font-weight: bold;
                margin: 0;
                text-align: center;
            }}
            p {{
                font-size: 16px;
                color: black;
            }}
            a {{
                display: inline-block;
                background: #61dafb;
                border: none;
                border-radius: 10px;
                color: black;
                padding: 10px 50px;
                text-decoration: none;
                margin-top: 20px;
                font-size: 16px;
                font-weight: 500;
            }}
            .footer {{
                margin-top: 20px;
                font-size: 12px;
                color: #aaaaaa;
            }}
        </style>
    </head>
    <body>
        <div class="email-container">
            <div class="logo-title">
                <div class="logo">
                    <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 6H42L36 24L42 42H6L12 24L6 6Z" fill="currentColor"></path>
                    </svg>
                </div>
                <h1>Quantum Quest</h1>
            </div>
            <h1>Reset Your Password</h1>
            <p>Hi there,</p>
            <p>We received a request to reset your password. Click the button below to reset it.</p>
            <a href="{body}" target="_blank">Reset Password</a>
            <p>If you didn't request a password reset, please ignore this email or reply to let us know.</p>
            <p class="footer">This link will expire in 1 hour.</p>
        </div>
    </body>
    </html>
    """

    msg.attach(MIMEText(html_body, 'html'))

    try:
        with smtplib.SMTP(app.config['MAIL_SERVER'], app.config['MAIL_PORT']) as server:
            if app.config['MAIL_USE_TLS']:
                server.starttls()
            server.login(app.config['MAIL_USERNAME'], app.config['MAIL_PASSWORD'])
            server.sendmail(app.config['MAIL_USERNAME'], to_email, msg.as_string())
        print(f'Email sent to {to_email}')
        return True
    except Exception as e:
        print(f'Failed to send email to {to_email}: {e}')
        return False

@app.route('/')
def index():
    if 'user_id' in session:
        user = User.find_one({'_id': ObjectId(session['user_id'])})
        if user:
            return render_template('index.html', user=user)
    return redirect(url_for('login'))

@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        email = request.form['email']
        password = request.form['password']
        user = User.find_one({'email': email})
        if user and check_password_hash(user['password'], password):
            session['user_id'] = str(user['_id'])
            return jsonify({'status': 'success', 'redirect': url_for('index')})
        else:
            return jsonify({'status': 'error', 'message': 'Invalid credentials'})
    return render_template('login.html')

@app.route('/register', methods=['GET', 'POST'])
def register():
    if request.method == 'POST':
        username = request.form['username']
        email = request.form['email']
        password = generate_password_hash(request.form['password'])
        
        existing_user = User.find_one({'email': email})
        if existing_user:
            return jsonify({'status': 'error', 'message': 'Email already registered'})
        
        encoded_string = None
        if 'profile_picture' in request.files:
            profile_picture = request.files['profile_picture']
            if profile_picture.filename != '':
                try:
                    filename = secure_filename(profile_picture.filename)
                    profile_picture.save(os.path.join('uploads', filename))
                    
                    with open(os.path.join('uploads', filename), "rb") as image_file:
                        encoded_string = base64.b64encode(image_file.read()).decode('utf-8')
                except Exception as e:
                    return jsonify({'status': 'error', 'message': f'Error uploading file: {str(e)}'})
        
        try:
            user = User.insert_one({
                'username': username,
                'email': email,
                'password': password,
                'profile_picture': encoded_string
            })
            
            session['user_id'] = str(user.inserted_id)
            return jsonify({'status': 'success', 'redirect': url_for('index')})
        except Exception as e:
            return jsonify({'status': 'error', 'message': f'Error registering user: {str(e)}'})
    return render_template('register.html')

@app.route('/forgot_password', methods=['GET', 'POST'])
def forgot_password():
    if request.method == 'POST':
        email = request.form['email']
        user = User.find_one({'email': email})
        if user:
            token = s.dumps(email, salt='email-confirm')
            link = url_for('reset_password', token=token, _external=True)
            if send_email(email, 'Reset Your Password', link):
                return jsonify({'status': 'success', 'message': 'Email sent, check your inbox to reset your password'})
            else:
                return jsonify({'status': 'error', 'message': 'Failed to send email'})
        else:
            return jsonify({'status': 'error', 'message': 'Email is not registered with our app'})
    return render_template('forgot_password.html')

@app.route('/reset_password/<token>', methods=['GET', 'POST'])
def reset_password(token):
    try:
        email = s.loads(token, salt='email-confirm', max_age=3600)
    except SignatureExpired:
        return '<h1>The token is expired!</h1>'
    if request.method == 'POST':
        password = request.form['password']
        confirm_password = request.form['confirm_password']
        if password != confirm_password:
            return jsonify({'status': 'error', 'message': 'Passwords do not match'})
        new_password = generate_password_hash(password)
        User.update_one({'email': email}, {'$set': {'password': new_password}})
        return jsonify({'status': 'success', 'message': 'Password reset successful', 'redirect': url_for('login')})
    return render_template('reset_password.html')

@app.route('/logout')
def logout():
    session.pop('user_id', None)
    return redirect(url_for('login'))

@app.route('/update_profile', methods=['POST'])
def update_profile():
    if 'user_id' not in session:
        return jsonify({'status': 'error', 'message': 'User not logged in'})

    user = User.find_one({'_id': ObjectId(session['user_id'])})
    if not user:
        return jsonify({'status': 'error', 'message': 'User not found'})

    username = request.form.get('username')
    password = request.form.get('password')
    profile_picture = request.files.get('profile_picture')

    update_data = {}

    if username and username != user['username']:
        update_data['username'] = username

    if password:
        update_data['password'] = generate_password_hash(password)

    if profile_picture:
        filename = secure_filename(profile_picture.filename)
        filepath = os.path.join('uploads', filename)
        profile_picture.save(filepath)
        with open(filepath, "rb") as image_file:
            encoded_string = base64.b64encode(image_file.read()).decode('utf-8')
        update_data['profile_picture'] = encoded_string
        os.remove(filepath)

    if update_data:
        User.update_one({'_id': ObjectId(session['user_id'])}, {'$set': update_data})
        return jsonify({'status': 'success', 'message': 'Profile updated successfully'})
    else:
        return jsonify({'status': 'error', 'message': 'No changes made'})

@app.route('/delete_account', methods=['POST'])
def delete_account():
    if 'user_id' not in session:
        return jsonify({'status': 'error', 'message': 'User not logged in'})

    user_id = ObjectId(session['user_id'])
    User.collection.delete_one({'_id': user_id})
    UserProgress.collection.delete_many({'user_id': str(user_id)})
    session.clear()
    return jsonify({'status': 'success', 'message': 'Account deleted successfully'})

@socketio.on('message')
def handle_message(message):
    response_type = generate_response(message['text'])
    
    if response_type == "start_quiz":
        question = get_question(message['subject'], message['difficulty'])
        emit('question', {'id': str(question['_id']), 'text': question['question_text']})
    elif response_type == "answer_question":
        is_correct, explanation = check_answer(message['question_id'], message['answer'])
        emit('answer', {'is_correct': is_correct, 'explanation': explanation})

if __name__ == '__main__':
    socketio.run(app, debug=True)`,`models.py`=`from database import db

class Question:
    collection = db.questions

    @staticmethod
    def create(subject, difficulty, question_text, correct_answer, explanation):
        return Question.collection.insert_one({
            "subject": subject,
            "difficulty": difficulty,
            "question_text": question_text,
            "correct_answer": correct_answer,
            "explanation": explanation
        })

    @staticmethod
    def find(query):
        return Question.collection.find(query)

    @staticmethod
    def find_one(query):
        return Question.collection.find_one(query)

class UserProgress:
    collection = db.user_progress

    @staticmethod
    def create(user_id, subject, correct_answers=0, total_questions=0):
        return UserProgress.collection.insert_one({
            "user_id": user_id,
            "subject": subject,
            "correct_answers": correct_answers,
            "total_questions": total_questions
        })

    @staticmethod
    def find(query):
        return UserProgress.collection.find(query)

    @staticmethod
    def update(query, update):
        return UserProgress.collection.update_one(query, update, upsert=True)

class User:
    collection = db.users

    @staticmethod
    def create(username, email, password, profile_picture):
        return User.collection.insert_one({
            "username": username,
            "email": email,
            "password": password,
            "profile_picture": profile_picture
        })

    @staticmethod
    def find_one(query):
        return User.collection.find_one(query)

    @staticmethod
    def update_one(query, update):
        return User.collection.update_one(query, update)
    
    @staticmethod
    def insert_one(data):
        return User.collection.insert_one(data)`, and together with the existing functionality, add the functionality from this response=`Certainly! Here's the complete `app.py` file and the `models.py` file formatted for easy copying and pasting into your project:

### `app.py`

```python
from flask import Flask, request, jsonify, session, Response
from flask_socketio import SocketIO
from werkzeug.security import generate_password_hash
from werkzeug.utils import secure_filename
import os
import base64
from bson import ObjectId
from pydub import AudioSegment
import speech_recognition as sr
from models import Question, UserProgress, User, Chat

app = Flask(__name__)
app.secret_key = 'your_secret_key'
socketio = SocketIO(app)

@app.route('/stream_response/<response_id>')
def stream_response(response_id):
    def generate():
        while True:
            chunk = get_next_chunk(response_id)  # Implement this function to get the next chunk of the response
            if chunk is None:
                break
            yield f"data: {chunk}\n\n"
    return Response(generate(), mimetype='text/event-stream')

@app.route('/transcribe', methods=['POST'])
def transcribe_audio():
    if 'audio' not in request.files:
        return jsonify({'error': 'No audio file provided'}), 400

    audio_file = request.files['audio']
    audio = AudioSegment.from_file(audio_file)
    audio.export("temp.wav", format="wav")

    recognizer = sr.Recognizer()
    with sr.AudioFile("temp.wav") as source:
        audio_data = recognizer.record(source)
        try:
            text = recognizer.recognize_google(audio_data)
            os.remove("temp.wav")
            return jsonify({'transcription': text})
        except sr.UnknownValueError:
            return jsonify({'error': 'Could not understand audio'}), 400
        except sr.RequestError:
            return jsonify({'error': 'Could not request results from speech recognition service'}), 500

@app.route('/chat_history')
def get_chat_history():
    user_id = session.get('user_id')
    if not user_id:
        return jsonify({'status': 'error', 'message': 'User not logged in'})

    chats = Chat.find({'user_id': user_id})
    history = [{'_id': str(chat['_id']), 'user_message': chat['messages'][0]['content']} for chat in chats]
    return jsonify({'status': 'success', 'history': history})

@app.route('/load_chat/<chat_id>')
def load_chat(chat_id):
    user_id = session.get('user_id')
    if not user_id:
        return jsonify({'status': 'error', 'message': 'User not logged in'})

    chat = Chat.find_one({'_id': ObjectId(chat_id), 'user_id': user_id})
    if not chat:
        return jsonify({'status': 'error', 'message': 'Chat not found'})

    messages = [{'sender': msg['role'], 'content': msg['content']} for msg in chat['messages']]
    return jsonify({'status': 'success', 'chat': messages})

@app.route('/delete_chat/<chat_id>', methods=['DELETE'])
def delete_chat(chat_id):
    user_id = session.get('user_id')
    if not user_id:
        return jsonify({'status': 'error', 'message': 'User not logged in'})

    result = Chat.delete_one({'_id': ObjectId(chat_id), 'user_id': user_id})
    if result.deleted_count:
        return jsonify({'status': 'success', 'message': 'Chat deleted'})
    else:
        return jsonify({'status': 'error', 'message': 'Chat not found'})

@app.route('/clear_all_chats', methods=['POST'])
def clear_all_chats():
    user_id = session.get('user_id')
    if not user_id:
        return jsonify({'status': 'error', 'message': 'User not logged in'})

    result = Chat.delete_many({'user_id': user_id})
    return jsonify({'status': 'success', 'message': f'{result.deleted_count} chats deleted'})

@app.route('/update_profile', methods=['POST'])
def update_profile():
    if 'user_id' not in session:
        return jsonify({'status': 'error', 'message': 'User not logged in'})

    user = User.find_one({'_id': ObjectId(session['user_id'])})
    if not user:
        return jsonify({'status': 'error', 'message': 'User not found'})

    username = request.form.get('username')
    password = request.form.get('password')
    profile_picture = request.files.get('profile_picture')

    update_data = {}

    if username and username != user['username']:
        update_data['username'] = username

    if password:
        update_data['password'] = generate_password_hash(password)

    if profile_picture:
        filename = secure_filename(profile_picture.filename)
        filepath = os.path.join('uploads', filename)
        profile_picture.save(filepath)
        with open(filepath, "rb") as image_file:
            encoded_string = base64.b64encode(image_file.read()).decode('utf-8')
        update_data['profile_picture'] = encoded_string
        os.remove(filepath)

    if update_data:
        User.update_one({'_id': ObjectId(session['user_id'])}, {'$set': update_data})
        return jsonify({'status': 'success', 'message': 'Profile updated successfully'})
    else:
        return jsonify({'status': 'error', 'message': 'No changes made'})

@app.route('/delete_account', methods=['POST'])
def delete_account():
    if 'user_id' not in session:
        return jsonify({'status': 'error', 'message': 'User not logged in'})

    user_id = ObjectId(session['user_id'])
    User.delete_one({'_id': user_id})
    Chat.delete_many({'user_id': str(user_id)})
    UserProgress.delete_many({'user_id': str(user_id)})
    session.clear()
    return jsonify({'status': 'success', 'message': 'Account deleted successfully'})

if __name__ == '__main__':
    socketio.run(app, debug=True)
```

### `models.py`

```python
from database import db
from bson import ObjectId

class Question:
    collection = db.questions

    @staticmethod
    def create(subject, difficulty, question_text, correct_answer, explanation):
        return Question.collection.insert_one({
            "subject": subject,
            "difficulty": difficulty,
            "question_text": question_text,
            "correct_answer": correct_answer,
            "explanation": explanation
        })

    @staticmethod
    def find(query):
        return Question.collection.find(query)

    @staticmethod
    def find_one(query):
        return Question.collection.find_one(query)

class UserProgress:
    collection = db.user_progress

    @staticmethod
    def create(user_id, subject, correct_answers=0, total_questions=0):
        return UserProgress.collection.insert_one({
            "user_id": user_id,
            "subject": subject,
            "correct_answers": correct_answers,
            "total_questions": total_questions
        })

    @staticmethod
    def find(query):
        return UserProgress.collection.find(query)

    @staticmethod
    def update(query, update):
        return UserProgress.collection.update_one(query, update, upsert=True)

class User:
    collection = db.users

    @staticmethod
    def create(username, email, password, profile_picture):
        return User.collection.insert_one({
            "username": username,
            "email": email,
            "password": password,
            "profile_picture": profile_picture
        })

    @staticmethod
    def find_one(query):
        return User.collection.find_one(query)

    @staticmethod
    def update_one(query, update):
        return User.collection.update_one(query, update)

    @staticmethod
    def insert_one(data):
        return User.collection.insert_one(data)

    @staticmethod
    def delete_one(query):
        return User.collection.delete_one(query)

class Chat:
    collection = db.chats

    @staticmethod
    def create(user_id, chat_id):
        return Chat.collection.insert_one({
            "_id": ObjectId(chat_id),
            "user_id": user_id,
            "messages": []
        })

    @staticmethod
    def add_message(chat_id, role, content):
        return Chat.collection.update_one(
            {"_id": ObjectId(chat_id)},
            {"$push": {"messages": {"role": role, "content": content}}}
        )

    @staticmethod
    def find(query):
        return Chat.collection.find(query)

    @staticmethod
    def find_one(query):
        return Chat.collection.find_one(query)

    @staticmethod
    def delete_one(query):
        return Chat.collection.delete_one(query)

    @staticmethod
    def delete_many(query):
        return Chat.collection.delete_many(query)
```

### Notes

To fully implement this system, you should:
1. Set up the OpenAI API client with your API key.
2. Implement the `get_next_chunk` function for streaming responses.
3. Set up proper error handling and logging.
4. Implement proper security measures, such as input validation and sanitization.
5. Set up the required dependencies (Flask-SocketIO, SpeechRecognition, pydub, etc.).
6. Configure your MongoDB database and update the `database.py` file accordingly.

Remember to test thoroughly and handle edge cases appropriately. Also, ensure that you comply with OpenAI's usage policies and any relevant data protection regulations.` so that the apps works well incoporating all these=`Implement the get_next_chunk function for streaming responses.
Set up proper error handling and logging.
Implement proper security measures, such as input validation and sanitization.
Set up the required dependencies (Flask-SocketIO, SpeechRecognition, pydub, etc.).` since the others have been setup, DO NOT DELETE OR CHANGE ANY CODE, JUST ADD THE MODIFICATIONS FIXING ERRORS WHERE POSSIBLE, i already have openai API key and my mongo db is set up ok, just make sure i can update user details and save them in database and display the user details in edit profile modal and display users profile image in the header and when i type and send chat it is appended in the chat area and the messages should have profile images for user and chatbot, and the messages should be formated in the structure i explained, i should be able to view chat history that is persisted in the chat area as it comes from the database and i should be able to delete individual messages, chat date and message time stamps should be shown as in Whatsapp messenger, also i should be able to copy message, reply to message and delete message in chat area, for the chat history side bar, i should be able to delete individual full chats or clear all the chats which ofcorse both delete chats from database and also add a button for `Start new chat` in side bar at the top before chat history so i can start new chats as in other GPTs, chat history should have a maximum height and i should be able to scroll through chats as they arranged according to chat date, and chat date is shown in side bar as well because a group of chats can belong to a single day, format accordingly if this is my style.css=`body {
    font-family: 'Space Grotesk', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    background: #101a23;
    color: white;
}

#auth-container {
    width: 100%;
    max-width: 400px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    text-align: center;
}

h2 {
    margin-bottom: 20px;
}

form {
    display: flex;
    flex-direction: column;
}

input {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    border-radius: 10px;
    padding: 10px;
    margin: 10px 0;
    color: white;
    font-size: 16px;
}

input::placeholder {
    color: #ccc;
}

#chat-container {
    width: 100%;
    height: 100vh;
    display: flex;
    background: #101a23;
    overflow: hidden;
}

#chat-sidebar {
    width: 250px;
    background: #1a2733;
    padding: 1rem;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

#chat-history-list {
    list-style-type: none;
    padding: 0;
    margin: 0;
    flex-grow: 1;
    overflow-y: auto;
}

#chat-history-list li {
    cursor: pointer;
    padding: 0.5rem;
    margin-bottom: 0.5rem;
    background: #223649;
    border-radius: 4px;
}

#clear-history {
    margin-top: 1rem;
    padding: 0.5rem;
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
}

#clear-history:hover {
    background: #c0392b;
}

#main-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
}

header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 40px;
    background: #101a23;
    border-bottom: 1px solid #223649;
}

.logo-title {
    display: flex;
    align-items: center;
    gap: 16px;
}

.logo {
    width: 16px;
    height: 16px;
    color: white;
}

header h1 {
    font-size: 18px;
    font-weight: bold;
    margin: 0;
}

.profile-dropdown {
    position: relative;
    display: inline-block;
}

#profile-img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid #61dafb;
    padding: 2px;
    object-fit: cover;
    transition: all 0.3s ease-in-out;
}

#profile-img:hover {
    border: 2px solid #0d80f2;
    ;
}

.dropdown-content {
    display: none;
    position: absolute;
    top: 50px;
    right: 0;
    background: #1a2733;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
    z-index: 1;
    border-radius: 5px;
    overflow: hidden;
}

.dropdown-content a {
    color: white;
    padding: 12px 16px;
    text-decoration: none;
    display: flex;
    align-items: center;
    transition: all 0.3s ease-in-out;
}

.dropdown-content a:hover {
    background: #223649;
}

.dropdown-content .logout-btn:hover {
    background: #c0392b;
}

.dropdown-content i {
    margin-right: 10px;
    font-size: 16px;
}

/* Modal styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(5px);
}

.modal-content {
    background: #1a2733;
    margin: 1.5% auto;
    padding: 30px;
    border: 1px solid #61dafb;
    width: 80%;
    max-width: 500px;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(97, 218, 251, 0.2);
}

.close {
    color: #61dafb;
    float: right;
    font-size: 28px;
    font-weight: bold;
    transition: all 0.3s ease-in-out;
}

.close:hover,
.close:focus {
    color: #0d80f2;
    text-decoration: none;
    cursor: pointer;
}

#profile-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

#profile-form input {
    background: #223649;
    border: none;
    padding: 12px;
    border-radius: 5px;
    color: white;
    font-size: 16px;
}

#profile-form button {
    background: #0d80f2;
    color: white;
    border: none;
    padding: 12px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s ease-in-out;
}

#profile-form button:hover {
    background: #61dafb;
}

.form-input {
    outline: none;
}

.danger-zone {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #223649;
}

#delete-account {
    background: #e74c3c;
    color: white;
    border: none;
    padding: 12px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s ease-in-out;
}

#delete-account:hover {
    background: #c0392b;
}

#chat-content {
    flex-grow: 1;
    overflow-y: auto;
    padding: 20px 160px;
    display: flex;
    flex-direction: column;
}

#chat-content h2 {
    text-align: center;
    font-size: 18px;
    margin-bottom: 8px;
}

#chat-content>p {
    text-align: center;
    font-size: 16px;
    margin-bottom: 20px;
    color: #fff;
}

#chat-messages {
    display: flex;
    flex-direction: column;
}

.message {
    max-width: 80%;
    margin-bottom: 16px;
    padding: 12px 16px;
    border-radius: 12px;
    font-size: 16px;
    line-height: 1.5;
}

.bot-message {
    align-self: flex-start;
    background: #223649;
}

.user-message {
    align-self: flex-end;
    background: #0d80f2;
}

.sender {
    font-size: 13px;
    color: #90adcb;
    margin-bottom: 4px;
}

#input-container {
    display: flex;
    padding: 12px 16px;
    background: #101a23;
    align-items: center;
    width: 90%;
    margin: 0 auto;
}

#user-input {
    flex-grow: 1;
    padding: 12px 16px;
    border: none;
    border-radius: 12px;
    background: #223649;
    color: white;
    font-size: 16px;
    max-height: 150px;
    resize: none;
    overflow-y: hidden;
}

#user-input::placeholder {
    color: #90adcb;
}

.custom-scrollbar {
    height: 30px;
    max-height: 150px;
    overflow-y: auto;
    padding: 10px;
    scrollbar-width: thin;
    scrollbar-color: #888 #f0f0f0;
}

.custom-scrollbar::-webkit-scrollbar {
    width: 8px;
}

.custom-scrollbar::-webkit-scrollbar-track {
    background: #f0f0f0;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
}

#mic-btn {
    background: none;
    border: none;
    color: #90adcb;
    cursor: pointer;
    padding: 8px;
    margin-left: 8px;
    transition: all 0.3s ease-in-out;
}

#mic-btn:hover {
    color: #e74c3c;
}

#mic-btn.recording {
    color: #e74c3c;
    animation: blink-animation 1s infinite;
}

@keyframes blink-animation {
    0% {
        opacity: 1;
    }

    50% {
        opacity: 0;
    }

    100% {
        opacity: 1;
    }
}

#send-btn {
    display: flex;
    align-items: center;
    color: white;
    background: #0d80f2;
    border-radius: 5px;
    padding: 10px 25px;
    font-size: 14px;
    border: none;
    cursor: pointer;
    font-weight: 500;
    margin-left: 8px;
    transition: all 0.3s ease-in-out;
}

#send-btn:hover {
    background: #61dafb;
}

@media (max-width: 768px) {
    #chat-container {
        width: 100%;
        height: 100vh;
        border-radius: 0;
    }

    #chat-content {
        padding: 20px;
    }
}

button {
    background: #61dafb;
    border: none;
    border-radius: 10px;
    padding: 10px;
    color: #101a23;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
}

button .button-text {
    display: inline-block;
}

button.loading .button-text {
    display: none;
}

button.loading .button-loader {
    display: inline-block;
}

.button-loader {
    display: none;
    width: 14px;
    height: 14px;
    border: 2px solid #101a23;
    border-top: 2px solid #61dafb;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }

    100% {
        transform: rotate(360deg);
    }
}

p {
    margin: 10px 0;
}

p a {
    color: #61dafb;
    text-decoration: none;
}

p a:hover {
    text-decoration: underline;
}

/* Styles for the notification pop-ups */
#notification-container {
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 1000;
}

.notification {
    background: rgba(27, 43, 56, 0.9);
    color: white;
    padding: 15px 20px;
    border-radius: 5px;
    margin-bottom: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    width: 300px;
    position: relative;
}

.notification-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.notification-close {
    background: none;
    border: none;
    color: #61dafb;
    cursor: pointer;
    font-size: 18px;
    padding: 0;
}

.notification-progress {
    background: rgba(97, 218, 251, 0.3);
    height: 3px;
    width: 100%;
    position: absolute;
    bottom: 0;
    left: 0;
    border-radius: 0 0 5px 5px;
}

.notification-progress-bar {
    background: #61dafb;
    height: 100%;
    width: 0;
    transition: width linear;
}

/* Styles for the confirmation pop-ups */
.confirmation {
    background: rgba(27, 43, 56, 0.9);
    color: white;
    padding: 15px 20px;
    border-radius: 5px;
    margin-bottom: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    width: 300px;
    position: relative;
}

.confirmation-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.confirmation-close {
    background: none;
    border: none;
    color: #61dafb;
    cursor: pointer;
    font-size: 18px;
    padding: 0;
}

.confirmation-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
}

.confirmation-actions button {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.confirm-yes {
    background: #61dafb;
    color: white;
}

.confirm-no {
    background: #e74c3c;
    color: white;
}

.success {
    border-left: 4px solid #4CAF50;
}

.error {
    border-left: 4px solid #e74c3c;
}

.loader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(16, 26, 35, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #61dafb;
    border-top: 5px solid #1b2b38;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

/* Adjustments for mobile responsiveness */
@media (max-width: 768px) {
    #chat-container {
        flex-direction: column;
    }

    #chat-sidebar {
        width: 100%;
        height: auto;
        max-height: 200px;
    }

    #main-content {
        width: 100%;
    }

    #chat-content {
        padding: 20px;
    }

    .modal-content {
        width: 95%;
        margin: 5% auto;
    }
}`